<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="TdRiskCheck">
	<resultMap id="BaseResultMap" type="com.calf.module.loan.entity.TdRiskCheck">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Jul 12 
			15:12:03 CST 2017. -->
		<id column="seq_risk_id" property="seqRiskId" />
		<result column="report_id" property="reportId" />
		<result column="item_id" property="itemId" />
		<result column="item_name" property="itemName" />
		<result column="risk_level" property="riskLevel" />
		<result column="group" property="group" />
		<result column="state" property="state" />
		<result column="create_time" property="createTime" />
		<result column="create_man" property="createMan" />
		<result column="modify_time" property="modifyTime" />
		<result column="modify_man" property="modifyMan" />
		<result column="remark" property="remark" />

	</resultMap>

	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Jul 12 
			15:12:03 CST 2017. -->
		seq_risk_id,report_id,item_id,item_name,risk_level,state,create_time,`group`,create_man,modify_time,modify_man,remark
	</sql>
	<select id="get" parameterType="map" resultMap="BaseResultMap">
		SELECT
		ad.seq_risk_id AS seqRiskId,
		ad.report_id AS reportId,
		ad.item_id as itemId,
		ad.item_name as itemName,
		ad.risk_level as riskLevel,
		ad.`group`,
		ad.state,
		a.use_id AS parentNameUserId,
		a.application_number,
		a.report_time as parentNameTime,
		a.score as parentNameSource,
		a.exception_inform,
		aw.fraud_type AS parentNameFraudType,
		aw.hit_type_displayname AS parentNameTypeDisplayname,
		aw.type AS parentNameType,
		aw.description AS parentNameDescription,
		aw.discredit_times AS parentNameDiscreditTime,
		a.risk_level,
		a.proposal,
		a.customer_id,
		a.platform_customer_id,
		a.`name` AS parentNameTitle,
		a.phone_num AS phoneNum,
		a.id_card AS parentNameIdCard,
		a.loan_date
		FROM
		td_audit_report a
		LEFT JOIN td_risk_check ad ON a.report_id = ad.report_id
		LEFT JOIN td_risk_check_detail aw ON aw.report_id = ad.report_id and
		aw.item_id=ad.item_id where ad.seq_risk_id=#{arg0} 
	</select>
	<select id="getAccountId" parameterType="map" resultMap="BaseResultMap">
		SELECT
		ad.seq_risk_id AS seqRiskId,
		ad.report_id AS reportId,
		ad.item_id as itemId,
		ad.item_name as itemName,
		ad.risk_level as riskLevel,
		ad.`group`,
		ad.state,
		a.use_id AS parentNameUserId,
		a.application_number,
		a.report_time as parentNameTime,
		a.score as parentNameSource,
		a.exception_inform,
		aw.fraud_type AS parentNameFraudType,
		aw.hit_type_displayname AS parentNameTypeDisplayname,
		aw.type AS parentNameType,
		aw.description AS parentNameDescription,
		aw.discredit_times AS parentNameDiscreditTime,
		a.risk_level,
		a.proposal,
		a.customer_id,
		a.platform_customer_id,
		a.`name` AS parentNameTitle,
		a.phone_num AS phoneNum,
		a.id_card AS parentNameIdCard,
		a.loan_date
		FROM
		td_audit_report a
		LEFT JOIN td_risk_check ad ON a.report_id = ad.report_id
		LEFT JOIN td_risk_check_detail aw ON aw.report_id = ad.report_id and
		aw.item_id=ad.item_id where ad.seq_risk_id=#{arg0}
	</select>
	<select id="queryCount" parameterType="map" resultType="int">
		select count(*) from td_risk_check where 1=1
		<if test="null != riskLevel and riskLevel != ''"> and risk_level = #{riskLevel} </if>
		<if test="null != reportId and reportId != ''"> and report_id = #{reportId} </if>
	</select>
	<select id="query" parameterType="map" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		td_risk_check where 1=1
		<if test="null != riskLevel and riskLevel != ''"> and risk_level = #{riskLevel} </if>
		<if test="null != reportId and reportId != ''"> and report_id = #{reportId} </if>
		ORDER BY
		create_time DESC
		LIMIT ${iDisplayStart}, ${iDisplayLength}
	</select>

	<select id="queryAll" parameterType="map" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		td_risk_check where 1=1
		order by create_time desc
	</select>
	<select id="queryProductByIds" parameterType="map" resultMap="BaseResultMap">
		SELECT discredit_times as parentNameDiscreditTime,type as
		parentNameType,fraud_type as
		parentNameFraudType,
		hit_type_displayname
		as parentNameTypeDisplayname,
		description as parentNameDescription FROM
		td_risk_check_detail WHERE
		td_risk_check_detail.`item_id` IN
		<if test="ids !=null and ids.size>0">
			<foreach item="item" index="index" collection="ids" open="("
				separator="," close=")">
				#{item}
			</foreach>
		</if>


	</select>
	<delete id="delete" parameterType="map">
		DELETE FROM td_risk_check
		WHERE
		seq_risk_id = #{arg0}
	</delete>
	<update id="update" parameterType="map">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Jul 12 
			15:12:03 CST 2017. -->
		update td_risk_check
		<set>
			<if test="reportId != null">
				report_id = #{reportId},
			</if>
			<if test="itemId != null">
				item_id = #{itemId},
			</if>
			<if test="itemName != null">
				item_name = #{itemName},
			</if>
			<if test="riskLevel != null">
				risk_level = #{riskLevel},
			</if>
			<if test="group != null">
				group = #{group},
			</if>
			<if test="state != null">
				state = #{state},
			</if>
			<if test="createTime != null">
				create_time = #{createTime},
			</if>
			<if test="createMan != null">
				create_man = #{createMan},
			</if>
			<if test="modifyTime != null">
				modify_time = #{modifyTime},
			</if>
			<if test="modifyMan != null">
				modify_man = #{modifyMan},
			</if>
			<if test="remark != null">
				remark = #{remark},
			</if>
		</set>
		where seq_risk_id = #{seqRiskId}
	</update>

</mapper>