<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Activity">

	<resultMap type="Activity" id="activityMap">
		<id column="activity_id" property="activityId" />
		<result column="title" property="title" />
		<result column="content" property="content" />
		<result column="begin_time" property="beginTime" />
		<result column="end_time" property="endTime" />
		<result column="use_id" property="useId" />
		<result column="pic_one" property="picOne" />
		<result column="pic_two" property="picTwo" />
		<result column="pic_three" property="picThree" />
		<result column="link_address" property="linkAddress" />
		<result column="if_hot" property="ifHot" />
		<result column="audit_time" property="auditTime" />
		<result column="audit_man" property="auditMan" />
		<result column="state" property="state" />
		<result column="create_time" property="createTime" />
		<result column="create_man" property="createMan" />
		<result column="modify_time" property="modifyTime" />
		<result column="modify_man" property="modifyMan" />
		<result column="remark" property="remark" />
		<result column="pushSuccessNumber" property="pushSuccessNumber" />
		<result column="checkNumber" property="checkNumber" />
		<result column="percentConversion" property="percentConversion" />
		
	</resultMap>

	<!-- 通用查询结果列 -->
	<sql id="Base_Column_List">
		activity_id, title, content, begin_time, end_time, use_id, pic_one, pic_two,
		pic_three,
		link_address, if_hot, audit_time, audit_man, state, create_time, create_man,
		modify_time,
		modify_man, remark
	</sql>
	<select id="get" parameterType="map" resultMap="activityMap">
		select
		<include refid="Base_Column_List" />
		from activity
	</select>
	<insert id="insert" parameterType="map">
		insert into activity (activity_id, title, content,
		begin_time, end_time, use_id,
		pic_one, pic_two, pic_three,
		link_address, if_hot, audit_time,
		audit_man, state, create_time,
		create_man, modify_time, modify_man,
		remark)
		values (#{activityId}, #{title,}, #{content},
		#{beginTime}, #{endTime}, #{useId},
		#{picOne}, #{picTwo}, #{picThree},
		#{linkAddress}, #{ifHot}, #{auditTime},
		#{auditMan}, #{state}, #{createTime},
		#{createMan}, #{modifyTime}, #{modifyMan},
		#{remark})
	</insert>
	<select id="queryCount" parameterType="map" resultType="int">
				SELECT count(*) FROM activity  where 1=1
	<if test="title !=null"> and title like concat('%',#{title},'%')</if>
		<if test="state !=null"> and state = #{state}</if>
		<if test="ifHot !=null"> and if_hot = #{ifHot} </if>
	</select>
	<select id="query" parameterType="map" resultMap="activityMap">
		
		SELECT  activity.activity_id, activity.title, activity.content, activity.begin_time, activity.end_time, activity.use_id, activity.pic_one, activity.pic_two,
		activity.pic_three,
		activity.link_address, activity.if_hot, activity.audit_time, activity.audit_man, activity.state, activity.create_time, activity.create_man,
		activity.modify_time,
		activity.modify_man, activity.remark,
        (IFNULL(activity.check_number,0)) AS checkNumber,(SELECT SUM(sms_template.push_success_number) FROM  sms_template WHERE sms_template.`detail_id` =activity.`activity_id`) AS pushSuccessNumber,
        
        (SELECT COUNT(*) FROM account WHERE account.app_channel_name = activity.activity_id) AS percentConversion FROM activity 
        where 1=1
		<if test="title !=null"> and activity.title like concat('%',#{title},'%')</if>
		<if test="state !=null"> and activity.state = #{state}</if>
		<if test="ifHot !=null"> and activity.if_hot = #{ifHot} </if>
		 GROUP BY activity.`activity_id`
		 order by activity.create_time desc
		limit ${iDisplayStart},${iDisplayLength}
	</select>
	
	<select id="queryAll" parameterType="map" resultMap="activityMap">
		SELECT  	
		<include refid="Base_Column_List" />
		FROM activity
		WHERE 1=1
		<if test="title !=null"> and title like concat('%',#{title},'%')</if>
		<if test="state !=null"> and state = #{state}</if>
	</select>
	
	<select id="getActivitys" parameterType="map" resultMap="activityMap">
		SELECT  	
		<include refid="Base_Column_List" />
		FROM activity
		WHERE state=1  and (remark is null or remark = '')
	</select>
	
	<select id="getActivityById" parameterType="map" resultMap="activityMap">
		SELECT
		<include refid="Base_Column_List" />
		FROM activity
		WHERE activity_id = #{arg0}
	</select>

	<delete id="delete" parameterType="map">
		DELETE FROM activity
		WHERE
		activity_id = #{arg0}
	</delete>
	<!-- 查询（根据主键ID查询） -->
	<!-- 修 改 -->
	<update id="update" parameterType="map">
		update activity
		<set>
			<if test="activityId != null">
				activity_id = #{activityId},
			</if>
			<if test="title != null">
				title = #{title},
			</if>
			<if test="content != null">
				content = #{content},
			</if>
			<if test="beginTime != null">
				begin_time = #{beginTime},
			</if>
			<if test="endTime != null">
				end_time = #{endTime},
			</if>
			<if test="useId != null">
				use_id = #{useId},
			</if>
			<if test="picOne != null">
				pic_one = #{picOne},
			</if>
			<if test="picTwo != null">
				pic_two = #{picTwo},
			</if>
			<if test="picThree != null">
				pic_three = #{picThree},
			</if>
			<if test="linkAddress != null">
				link_address = #{linkAddress},
			</if>
			<if test="ifHot != null">
				if_hot = #{ifHot},
			</if>
			<if test="auditTime != null">
				audit_time = #{auditTime},
			</if>
			<if test="auditMan != null">
				audit_man = #{auditMan},
			</if>
			<if test="state != null">
				state = #{state},
			</if>
			<if test="createTime != null">
				create_time = #{createTime},
			</if>
			<if test="createMan != null">
				create_man = #{createMan},
			</if>
			<if test="modifyTime != null">
				modify_time = #{modifyTime},
			</if>
			<if test="modifyMan != null">
				modify_man = #{modifyMan},
			</if>
			<if test="remark != null">
				remark = #{remark},
			</if>
		</set>
		WHERE activity_id = #{activityId}
	</update>

</mapper>