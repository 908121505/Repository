<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ArticlePost" >
  <resultMap id="BaseResultMap" type="com.calf.module.articlepost.entity.ArticlePost" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    <id column="article_post_id" property="articlePostId" jdbcType="VARCHAR" />
    <result column="article_post_title" property="articlePostTitle" jdbcType="VARCHAR" />
    <result column="article_post_content" property="articlePostContent" jdbcType="VARCHAR" />
    <result column="article_post_img" property="articlePostImg" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="create_man" property="createMan" jdbcType="VARCHAR" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="modify_man" property="modifyMan" jdbcType="VARCHAR" />
     <result column="read_num" property="readNum" jdbcType="INTEGER" />
    <result column="account_id" property="accountId" jdbcType="VARCHAR" />
    <result column="number_comment" property="numberComment" jdbcType="INTEGER"/>
     <result column="praise_number" property="praiseNumber" jdbcType="INTEGER"/>
    <result column="prefecture_id" property="prefectureId" jdbcType="VARCHAR" />
    <result column="is_essence" property="isEssence" jdbcType="INTEGER" />
	 <result column="state" property="state" jdbcType="INTEGER" />
	<result column="link_url_h" property="linkUrl" jdbcType="VARCHAR" />
	<result column="product_ids" property="productIds" jdbcType="VARCHAR" />
	<result column="productNames" property="productNames" jdbcType="VARCHAR" />
	<result  column="account_avatar" property="accountAvatar" jdbcType="VARCHAR" />  
	<result column="account_nick_name"  property="accountNickName" jdbcType="VARCHAR" />  
	<result column="label_background_img"  property="labelBackgroundImg" jdbcType="VARCHAR" />  
	<result column="breviary_content"  property="breviaryContent" jdbcType="VARCHAR" />  
	<result column="top_order"  property="topOrder" jdbcType="VARCHAR" />
    <result column="article_position" property="articlePosition" jdbcType="INTEGER"/>
	
	
	<association property="account" column="account_id" javaType="Account">
	<id property="accountId" column="account_id"/>  
	<result property="nickname" column="nickname"/>  
	
    </association>  
	

  </resultMap>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    article_post_id, article_post_title, article_post_content, article_post_img, create_time, praise_number,
    create_man, modify_time, modify_man,read_num,account_id,number_comment,prefecture_id,state,link_url_h,is_essence,product_ids,account_avatar,account_nick_name
    ,label_background_img,breviary_content,top_order,article_position
  </sql>
  
  
    <sql id="Base_Column_List2" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    ap.article_post_id, ap.article_post_title, ap.article_post_content, ap.article_post_img, ap.create_time, 
    ap.create_man, ap.modify_time, ap.modify_man,ap.read_num,ap.account_id,ap.number_comment,ap.prefecture_id,ap.state,link_url_h,ap.is_essence,ap.product_ids,ap.account_avatar,ap.account_nick_name
    ,ap.label_background_img,ap.breviary_content,ap.top_order,article_position
  </sql>
  
  <sql id="condition_query" >
     <if test="articlePostTitle !=null"> and article_post_title like concat('%',#{articlePostTitle},'%')</if>
	<if test="articlePostContent !=null"> and article_post_content  like concat('%',#{articlePostContent},'%')</if>
	<if test="createMan !=null"> and ap.create_man = #{createMan}</if>
    <if test="isEssence !=null"> and ap.is_essence = #{isEssence}</if>
	<if test="nickname !=null"> and ap.account_nick_name = #{nickname}</if>
	<if test="state !=null"> and ap.state= #{state}</if>
    <if test="phoneNum !=null and phoneNum != ''">
          and ap.account_id = (select account_id from account where phone_num = #{phoneNum} )
    </if>
    <if test="startPosition != null and startPosition != ''">
      AND ap.article_position <![CDATA[   >=  ]]>   #{startPosition}
    </if>
    <if test="endPosition != null and endPosition != ''">
      AND ap.article_position <![CDATA[ <= ]]> #{endPosition}
    </if>
    <if test="postIdsList != null">
      AND ap.article_post_id
      IN
      (
        <foreach collection="postIdsList" item="item" index="index" separator=",">
          #{item,jdbcType=VARCHAR}
        </foreach>
      )
    </if>
  </sql>
  
  <select id="queryCount" parameterType="map" resultType="int">
	      select
	count(article_post_id)
		from article_post ap  where 1=1
		 <include refid="condition_query"></include>
	</select>
	
	<select id="queryAll" parameterType="map" resultMap="BaseResultMap">
        select
		<include refid="Base_Column_List2" />
		from article_post ap
		where 1=1
		<if test="state !=null"> and ap.state= #{state}</if>
		<if test="orderStr !=null"> order by  ${orderStr}</if>
	
  </select>
	
	<select id="query" parameterType="map" resultMap="BaseResultMap">
   select
		<include refid="Base_Column_List2" />
		from article_post ap
		where 1=1
		 <include refid="condition_query"></include>
		<if test="orderStr !=null"> order by  ${orderStr}</if>
		limit ${iDisplayStart},${iDisplayLength}
	
  </select>
  
   <select id="get" parameterType="map" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from article_post
		WHERE article_post_id = #{arg0}
	</select>
	
	 <select id="queryProductByIds" parameterType="map" resultMap="BaseResultMap">
		  SELECT GROUP_CONCAT(product_name) as productNames FROM product WHERE 
		  product.`product_id` IN
		    <if test="ids !=null and ids.size>0"> 
			<foreach item="item" index="index" collection="ids" open="(" separator="," close=")">
				#{item}
			</foreach>
	    </if>
		  

   </select>
	
	<update id="updateAuditStatus" parameterType="Map" >
	   UPDATE `article_post`   SET article_post.`state` = CASE article_post.state 
	   WHEN 4 THEN 1
	   WHEN 3 THEN 1
	   ELSE
	     article_post.`state`
	   END WHERE article_post.`article_post_id` IN
        <if test="articlePostIds !=null and articlePostIds.size>0"> 
			<foreach item="item" index="index" collection="articlePostIds" open="(" separator="," close=")">
				#{item}
			</foreach>
	    </if>
    </update>
    
    <update id="updateRejectedStatus" parameterType="Map" >
	   UPDATE `article_post`   SET article_post.`state` = CASE article_post.state 
	   WHEN 1 THEN 4
	   WHEN 3 THEN 4
	   ELSE
	     article_post.`state`
	   END WHERE article_post.`article_post_id` IN
        <if test="articlePostIds !=null and articlePostIds.size>0"> 
			<foreach item="item" index="index" collection="articlePostIds" open="(" separator="," close=")">
				#{item}
			</foreach>
	    </if>
    </update>
  
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.calf.module.articlepost.entity.ArticlePost" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from article_post
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from article_post
    where article_post_id = #{articlePostId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    delete from article_post
    where article_post_id = #{articlePostId,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByExample" parameterType="com.calf.module.articlepost.entity.ArticlePost" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    delete from article_post
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.calf.module.articlepost.entity.ArticlePost" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    insert into article_post (article_post_id, article_post_title, 
      article_post_content, article_post_img, create_time, 
      create_man, modify_time, modify_man,prefecture_id,is_essence,state,product_ids,account_id,read_num,number_comment,praise_number,account_avatar,account_nick_name
      ,label_background_img,breviary_content,top_order,article_position)
    values (#{articlePostId,jdbcType=VARCHAR}, #{articlePostTitle,jdbcType=VARCHAR}, 
      #{articlePostContent,jdbcType=VARCHAR}, #{articlePostImg,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
      #{createMan,jdbcType=VARCHAR}, #{modifyTime,jdbcType=TIMESTAMP}, #{modifyMan,jdbcType=VARCHAR},
      #{prefectureId,jdbcType=VARCHAR},#{isEssence,jdbcType=INTEGER},#{state,jdbcType=INTEGER}
     ,#{productIds,jdbcType=VARCHAR},#{accountId,jdbcType=VARCHAR},#{readNum,jdbcType=INTEGER},#{numberComment,jdbcType=INTEGER},#{praiseNumber,jdbcType=INTEGER}, #{accountAvatar,jdbcType=VARCHAR}, #{accountNickName,jdbcType=VARCHAR}
      ,#{labelBackgroundImg},#{breviaryContent},#{topOrder},#{articlePosition})
  </insert>
  <insert id="insertSelective" parameterType="com.calf.module.articlepost.entity.ArticlePost" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    insert into article_post
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="articlePostId != null" >
        article_post_id,
      </if>
      <if test="articlePostTitle != null" >
        article_post_title,
      </if>
      <if test="articlePostContent != null" >
        article_post_content,
      </if>
      <if test="articlePostImg != null" >
        article_post_img,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="createMan != null" >
        create_man,
      </if>
      <if test="modifyTime != null" >
        modify_time,
      </if>
      <if test="modifyMan != null" >
        modify_man,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="articlePostId != null" >
        #{articlePostId,jdbcType=VARCHAR},
      </if>
      <if test="articlePostTitle != null" >
        #{articlePostTitle,jdbcType=VARCHAR},
      </if>
      <if test="articlePostContent != null" >
        #{articlePostContent,jdbcType=VARCHAR},
      </if>
      <if test="articlePostImg != null" >
        #{articlePostImg,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createMan != null" >
        #{createMan,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null" >
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyMan != null" >
        #{modifyMan,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.calf.module.articlepost.entity.ArticlePost" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    select count(*) from article_post
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    update article_post
    <set >
      <if test="record.articlePostId != null" >
        article_post_id = #{record.articlePostId,jdbcType=VARCHAR},
      </if>
      <if test="record.articlePostTitle != null" >
        article_post_title = #{record.articlePostTitle,jdbcType=VARCHAR},
      </if>
      <if test="record.articlePostContent != null" >
        article_post_content = #{record.articlePostContent,jdbcType=VARCHAR},
      </if>
      <if test="record.articlePostImg != null" >
        article_post_img = #{record.articlePostImg,jdbcType=VARCHAR},
      </if>
      <if test="record.createTime != null and record.createTime!=''" >
        create_time = #{record.createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.createMan != null and record.createMan!=''" >
        create_man = #{record.createMan,jdbcType=VARCHAR},
      </if>
      <if test="record.modifyTime != null and record.modifyTime!=''" >
        modify_time = #{record.modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.modifyMan != null and record.modifyMan!=''" >
        modify_man = #{record.modifyMan,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="update" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    update article_post
    set article_post_id = #{articlePostId,jdbcType=VARCHAR},
      article_post_title = #{articlePostTitle,jdbcType=VARCHAR},
      article_post_content = #{articlePostContent,jdbcType=VARCHAR},
      <if test="articlePostImg != null" >
      article_post_img = #{articlePostImg,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="state != null" >
        state= #{state,jdbcType=INTEGER},
      </if>
      create_man = #{createMan,jdbcType=VARCHAR},
      modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      modify_man = #{modifyMan,jdbcType=VARCHAR},
      prefecture_id= #{prefectureId,jdbcType=VARCHAR},
      is_essence= #{isEssence,jdbcType=INTEGER},
      link_url_h= #{linkUrl,jdbcType=VARCHAR},
      account_id =#{accountId,jdbcType=VARCHAR},
      product_ids = #{productIds,jdbcType=VARCHAR},
      number_comment=#{numberComment,jdbcType=INTEGER},
      praise_Number=#{praiseNumber,jdbcType=INTEGER},
      read_num=#{readNum,jdbcType=INTEGER},
      account_avatar=#{accountAvatar,jdbcType=VARCHAR},
      account_nick_name=#{accountNickName,jdbcType=VARCHAR},
      label_background_img=#{labelBackgroundImg},
      breviary_content=#{breviaryContent},
      <if test="isEssence!=5">
        top_order =null,
      </if>
      <if test="isEssence==5">
        top_order=#{topOrder},
      </if>
      <if test="isEssence != 3">
        article_position = null
      </if>
      <if test="isEssence == 3">
        article_position = #{articlePosition}
      </if>
       WHERE article_post_id = #{articlePostId}
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.calf.module.articlepost.entity.ArticlePost" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    update article_post
    <set >
      <if test="articlePostTitle != null" >
        article_post_title = #{articlePostTitle,jdbcType=VARCHAR},
      </if>
      <if test="articlePostContent != null" >
        article_post_content = #{articlePostContent,jdbcType=VARCHAR},
      </if>
      <if test="articlePostImg != null" >
        article_post_img = #{articlePostImg,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createMan != null" >
        create_man = #{createMan,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null" >
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyMan != null" >
        modify_man = #{modifyMan,jdbcType=VARCHAR},
      </if>
    </set>
    where article_post_id = #{articlePostId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.calf.module.articlepost.entity.ArticlePost" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 05 18:57:58 CST 2017.
    -->
    update article_post
    set article_post_title = #{articlePostTitle,jdbcType=VARCHAR},
      article_post_content = #{articlePostContent,jdbcType=VARCHAR},
      article_post_img = #{articlePostImg,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      create_man = #{createMan,jdbcType=VARCHAR},
      modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      modify_man = #{modifyMan,jdbcType=VARCHAR}
    where article_post_id = #{articlePostId,jdbcType=VARCHAR}
  </update>
  
  
  <update id="updateNumberComment" parameterType="com.calf.module.articlepost.entity.ArticlePost">
    update article_post
    set number_comment=number_comment-#{numberComment,jdbcType=INTEGER}
    where article_post_id = #{articlePostId,jdbcType=VARCHAR}
  </update>
  <update id="updateNumberCommentAdd" parameterType="com.calf.module.articlepost.entity.ArticlePost">
    update article_post
    set number_comment=number_comment+#{numberComment,jdbcType=INTEGER}
    where article_post_id = #{articlePostId,jdbcType=VARCHAR}
  </update>
  
  <!-- 查询详情 -->
  <select id="selectPostingCount" resultType="int" parameterType="map" >
    
      SELECT count(*)
		 FROM `article_post` where 1=1
         <if test="articlePostId!=null and articlePostId!=''">
             and article_post.article_post_id = #{articlePostId}
         </if>
        
         ORDER BY article_post.create_time DESC 
    
 </select>
  
  <!-- 查询详情 -->
  <select id="selectPosting" resultMap="BaseResultMap" parameterType="map" >
    
      SELECT article_post.article_post_id, 
		article_post.article_post_title, 
		article_post.article_post_content, 
		article_post.article_post_img,
		article_post.create_time, 
		articlePost.user_avatar,	
		articlePost.`nickname` ,
		article_post.read_num ,
		article_post.number_comment,
		
		article_reply.`content` AS replyContent,
		replyAccount.nickname AS replyNickName,
		replyAccount.user_avatar AS replyUserAvatar,	
		article_reply.`create_time` AS replyCreateTime,
		article_reply.id as replyId,
		
		GROUP_CONCAT(ar.content) AS sunReplyContent,
		GROUP_CONCAT(sunAccount.nickname) AS sunReplyNickName

		 FROM `article_post` 
		 LEFT JOIN `article_reply` ON article_post_id = article_reply.`post_id`
		 LEFT JOIN `account` replyAccount ON  replyAccount.`account_id` = article_reply.`account_id`
		 LEFT JOIN `account` articlePost ON  articlePost.`account_id` = article_post.`account_id`
		 LEFT JOIN article_reply ar  ON  ar.parent_Id = article_reply.id
		 LEFT JOIN `account` sunAccount ON  sunAccount.`account_id` = ar.`account_id` 
		   WHERE 1=1 
         <if test="articlePostId!=null and articlePostId!=''">
             and article_post.article_post_id = #{articlePostId}
         </if>
         GROUP BY article_post.article_post_id,article_reply.`id`
         ORDER BY article_post.create_time DESC LIMIT ${currentPage},${pageSize}
    
 </select>
 
 <!-- 查询所有帖子 -->
   <select id="selectAllInvitation" resultMap="BaseResultMap" parameterType="map" >
    
  
  SELECT  article_post.article_post_id, 
                 article_post.article_post_title, 
                 article_post.article_post_content, 
                 article_post.article_post_img, 
                 article_post.create_time,
                 article_post.`read_num`,
                 article_post.number_comment,
                 articlePost.`nickname`,
                 articlePost.user_avatar,
                 article_attention.`account_id`,
                 GROUP_CONCAT(article_attention.`account_id`) as attentionAllId
                 
		       FROM `article_post` 
	           LEFT JOIN `account` articlePost ON  articlePost.`account_id` = article_post.`account_id`
               LEFT JOIN  article_attention ON article_attention.`attention_id`= articlePost.`account_id`
               where 1=1
               <if test="prefectureId!=null and prefectureId!=''">
                    and article_post.prefecture_id = #{prefectureId}
               </if>
               
                <if test="isEssence!=null and isEssence!=''">
                     and article_post.is_essence = #{isEssence}
               </if>
               
                GROUP BY article_post.`article_post_id`
                order by article_post.create_time desc LIMIT ${currentPage},${pageSize}
         
 </select>
 
 
 <select id="selectAllInvitationCount" resultType="int" parameterType="map" >
    
  
  SELECT  count(*)
                 
		       FROM `article_post` 
	         
               where 1=1
               <if test="prefectureId!=null and prefectureId!=''">
                    and article_post.prefecture_id = #{prefectureId}
               </if>
               
                <if test="isEssence!=null and isEssence!=''">
                     and article_post.is_essence = #{isEssence}
               </if>
               
 </select>
 
 <select id="queryAllPost" resultType="string" parameterType="map">
    <![CDATA[  
     SELECT article_post.`article_post_id` FROM `article_post`
    ]]>  
   
 </select>
 
 <select id="queryAllArticle" resultType="string" parameterType="map">
   <![CDATA[  
     SELECT article.`article_id` FROM `article` WHERE 
     TIMESTAMPDIFF(SECOND,article.`create_time`,NOW())> ${houarValue} 
     AND TIMESTAMPDIFF(SECOND,article.`create_time`,NOW())<(${houarValue}+180)
    ]]>  
   
 </select>
 
 <update id="updatePostReadNumPraise" parameterType="map">
       UPDATE `article_post` SET 
       read_num =IFNULL(read_num,0)+${growingNumber} 
       WHERE article_post.`article_post_id` =#{articleId}
       
</update>
 
 <update id="updatePostReadNumPraiseTigger" parameterType="map">
       UPDATE `article_post` SET 
       read_num =IFNULL(read_num,0)+${growingNumber},praise_number =IFNULL(praise_number,0)+#{growingNumber}  
       WHERE state=1
      <if test="id!=null and id!=''">
           and article_post_Id = #{id}
       </if>
</update>
 
 <update id="updateArticleReadNumPraise" parameterType="map">
       UPDATE `article` SET read_num = IFNULL(read_num,0)+${growingNumber} WHERE article.`article_id` =#{articleId}
</update>

 <update id="updateArticleReadNumPraiseTigger" parameterType="map">
       UPDATE `article` SET read_num = IFNULL(read_num,0)+#{growingNumber},praise_num =IFNULL(praise_num,0)+#{growingNumber} 
       WHERE state=1 
       <if test="id!=null and id!=''">
           and article_Id = #{id}
       </if>
</update>

 <!--插入点赞数-->
  <insert id="insertAllPraise" parameterType="map">
     
       INSERT INTO `article_praise`(`article_praise_id`,state,article_id) VALUE(#{id},'1',#{postId});
    
  </insert>
  
  <select id="queryBytopOrder" parameterType="Map" resultMap="BaseResultMap">
  
  select <include refid="Base_Column_List" />
  from article_post
  where top_order=#{topOrder}
  </select>
  
  
  
  
</mapper>