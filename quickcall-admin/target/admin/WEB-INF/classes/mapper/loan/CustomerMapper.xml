<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Customer">
	<resultMap id="CustomerResultMap" type="Customer">
		<id property="customerId" column="customer_id" />
		<id property="accountId" column="account_id" />
		<id property="name" column="name" />
		<id property="idCode" column="id_code" />
		<id property="provinceId" column="province_id" />
		<id property="provinceName" column="province_name" />
		<id property="cityId" column="city_id" />
		<id property="cityName" column="city_name" />
		<id property="areaId" column="area_id" />
		<id property="areaName" column="area_name" />
		<id property="addressDetail" column="address_detail" />
		<id property="birth" column="birth" />
		<id property="gender" column="gender" />
		<id property="email" column="email" />
		<id property="age" column="age" />
		<id property="educationId" column="education_id" />
		<id property="professionId" column="profession_id" />
		<id property="companyName" column="company_name" />
		<id property="companyTel" column="company_tel" />
		<id property="companyProvinceId" column="company_province_id" />
		<id property="companyProvinceName" column="company_province_name" />
		<id property="companyCityId" column="company_city_id" />
		<id property="companyCityName" column="company_city_name" />
		<id property="companyAreaId" column="company_area_id" />
		<id property="companyAreaName" column="company_area_name" />
		<id property="companyAddressDetail" column="company_address_detail" />
		<id property="ifMarriage" column="if_marriage" />
		<id property="auditMan" column="audit_man" />
		<id property="auditTime" column="audit_time" />
		<id property="state" column="state" />
		<id property="createMan" column="create_man" />
		<id property="createTime" column="create_time" />
		<id property="modifyMan" column="modify_man" />
		<id property="modifyTime" column="modify_time" />
		<id property="remark" column="remark" />
		<id property="phoneType" column="phone_type" />
		<id property="phoneNum" column="phone_num"/>
	</resultMap>

	<sql id="Base_Column_List">
		  customer_id,
		  account_id,
		  NAME,
		  id_code,
		  province_id,
		  province_name,
		  city_id,
		  city_name,
		  area_id,
		  area_name,
		  address_detail,
		  birth,
		  gender,
		  email,
		  age,
		  education_id,
		  profession_id,
		  company_name,
		  company_tel,
		  company_province_id,
		  company_province_name,
		  company_city_id,
		  company_city_name,
		  company_area_id,
		  company_area_name,
		  company_address_detail,
		  if_marriage,
		  audit_man,
		  DATE_FORMAT(
		  audit_time,
		  '%Y-%c-%d %H:%i:%s'
		  ) AS audit_time,
		  state,
		  create_man,
		  DATE_FORMAT(
			create_time,
			'%Y-%c-%d %H:%i:%s'
		  ) AS create_time,
		  DATE_FORMAT(
			modify_time,
			'%Y-%c-%d %H:%i:%s'
		  ) AS modify_time,
		  modify_man,
		  remark
	</sql>

	<select id="queryCount" parameterType="map" resultType="int">
		select count(customer_id) from customer where 1=1
		<if test="name !=null"> and name like concat('%',#{name},'%')</if>
		<if test="idCode !=null"> and id_code like concat('%',#{idCode},'%')</if>
		<if test="state !=null"> and state = #{state}</if>
	</select>
	<select id="query" parameterType="map" resultMap="CustomerResultMap">
		select
		<include refid="Base_Column_List" />
		from
		customer where 1=1
		<if test="name !=null"> and name like concat('%',#{name},'%')</if>
		<if test="idCode !=null"> and id_code like concat('%',#{idCode},'%')</if>
		<if test="state !=null"> and state = #{state}</if>
		limit ${iDisplayStart},${iDisplayLength}
	</select>

	<select id="getCustomerById" parameterType="map" resultMap="CustomerResultMap">
		SELECT
		<include refid="Base_Column_List" />
		FROM customer
		WHERE customer_id = #{arg0}
	</select>

	<update id="update" parameterType="map">
		UPDATE customer
		<set>
			<if test="modifyTime != null and modifyTime != ''">
				modify_time = #{modifyTime},
			</if>
			<if test="modifyMan != null">
				modify_man = #{modifyMan},
			</if>
			<if test="remark != null">
				remark = #{remark},
			</if>
		</set>
		WHERE customer_id = #{customerId}
	</update>

   <select id="get" parameterType="map" resultMap="CustomerResultMap">
		
       SELECT
		  account.account_id as customer_id,account.phone_type
		FROM account 
	        WHERE 1=1
		AND account.phone_num=#{arg0}
	
	</select>

     <select id="queryList" parameterType="map" resultMap="CustomerResultMap">
		 SELECT
		  account.account_id AS customer_id,account.phone_type as phone_type,account.phone_num
		FROM account 
		WHERE state=1
		
		
	</select>
	
	 <select id="queryListByPhoneNums" parameterType="map" resultMap="CustomerResultMap">
		 SELECT
		  account.account_id AS customer_id,account.phone_type as phone_type,account.phone_num
		FROM account 
		WHERE state=1
		  <if test="phoneNums != null">
			AND	phone_num in 
				<foreach collection="phoneNums" open="(" separator="," close=")" item="phoneNum">
				(#{phoneNum})
			    </foreach>
			</if>
	</select>
	
	  <select id="queryDevice" parameterType="map" resultMap="CustomerResultMap">
		 SELECT
		  account.device_id AS customer_id
		FROM account 
		WHERE 1=1
		
	</select>

   <select id="queryByPhoneTypeAndroid" parameterType="map" resultMap="CustomerResultMap">
		 SELECT
		  account.account_id AS customer_id,account.phone_type,account.phone_num
		FROM account 
		WHERE state=1
		 AND  account.phone_type  NOT LIKE '%iPhone%'
	 
	</select>
	
	
	 <select id="queryByPhoneTypeIOS" parameterType="map" resultMap="CustomerResultMap">
		 SELECT
		  account.account_id AS customer_id,account.phone_type,account.phone_num
		FROM account 
		WHERE state=1
		
		AND account.phone_type like '%iPhone%'
		
		 
	</select>
	
	<select id="getCustomerInfoById" parameterType="map" resultType="map">
		SELECT
		*
		FROM customer_info
		WHERE detailInfoId = #{arg0}
		<!--<if test="arg1 != null and arg1 != '' and arg1 != 'null'">-->
			<!--AND  userLabel = #{arg1}-->
		<!--</if>-->
		<!--<if test="arg1 == 'null' or arg1 == null or arg1 == ''">-->
			<!--and (userLabel is NULL or userLabel = '')-->
		<!--</if>-->
	</select>


</mapper>
