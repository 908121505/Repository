<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ArticlePostLable">

	<resultMap type="ArticlePostLable" id="articlePostLableMap">
		<id property="id" column="id" javaType="java.lang.String"></id>
		<result property="lableName" column="lable_name" javaType="java.lang.String"></result>
		<result property="createTime" column="create_time" javaType="java.lang.String"></result>
		<result property="createMan" column="create_man" javaType="java.lang.String"></result>
		<result property="modifyTime" column="modify_time" javaType="java.lang.String"></result>
		<result property="modifyMan" column="modify_man" javaType="java.lang.String"></result>
		<result property="remark" column="remark" javaType="java.lang.String"></result>
		<result property="relationArticlePostId" column="articlePostId" javaType="java.lang.String"></result>
		<result property="relationArticlePostLableId" column="articlePostLableId" javaType="java.lang.String"></result>
	</resultMap>

	<!-- 通用查询结果列-->
	<sql id="Base_Column_List">
id,	lable_name,	create_time,	create_man,	modify_time,	modify_man,	remark
	</sql>

	<!-- 查询（根据主键ID查询） -->
	<select id="getEntityById" resultMap="articlePostLableMap" parameterType="java.lang.String">
		 SELECT
		 <include refid="Base_Column_List" />
		 FROM article_post_lable
		 WHERE id = #{arg0}
	</select>

	<!-- 查询（根据主键ID查询） -->
	<select id="findAll" resultMap="articlePostLableMap" parameterType="java.lang.String">
		 SELECT
		 <include refid="Base_Column_List" />
		 FROM article_post_lable
		 WHERE id = #{id}
	</select>

	<!--删除：根据主键ID删除-->
	<delete id="delete" parameterType="java.lang.String">
		 DELETE FROM article_post_lable
		 WHERE id = #{arg0}
	</delete>

	<!-- 添加 -->
	<insert id="insert" parameterType="ArticlePostLable">
		 INSERT INTO article_post_lable
 		(id,lable_name,create_time,create_man,modify_time,modify_man,remark)
		 VALUES 
 		(#{id},#{lableName},#{createTime},#{createMan},#{modifyTime},#{modifyMan},#{remark})
	</insert>

	<!-- 修 改-->
	<update id="update" parameterType="ArticlePostLable">
		 UPDATE article_post_lable
 		 <set> 
			<if test="lableName != null">
				 lable_name = #{lableName},
			</if>
			<if test="createTime != null">
				 create_time = #{createTime},
			</if>
			<if test="createMan != null">
				 create_man = #{createMan},
			</if>
			<if test="modifyTime != null">
				 modify_time = #{modifyTime},
			</if>
			<if test="modifyMan != null">
				 modify_man = #{modifyMan},
			</if>
			<if test="remark != null">
				 remark = #{remark},
			</if>

 		 </set>
		 WHERE id = #{id}
	</update>
	<select id="query" parameterType="map" resultMap="articlePostLableMap">
		SELECT apl.id,apl.lable_name,count(apr.article_post_lable_id) lableCount,apl.modify_man,apl.modify_time
		FROM article_post_lable apl
		LEFT JOIN article_post_relation apr
		ON apl.id = apr.article_post_lable_id
		GROUP BY apl.id
		ORDER BY apl.modify_time
		<if test="iDisplayStart != null">
			limit ${iDisplayStart},${iDisplayLength}
		</if>
	</select>
	<select id="getCount" parameterType="java.util.Map" resultType="java.lang.Integer">
		SELECT count(1)
		FROM article_post_lable apl
	</select>
	<insert id="insertRelation" parameterType="map">
		 INSERT INTO article_post_relation
 		(id,article_post_id,article_post_lable_id,create_time,create_man,modify_time,modify_man,remark)
		 VALUES
 		(#{id},#{articlePostId},#{articlePostLableId},#{createTime},#{createMan},#{modifyTime},#{modifyMan},#{remark})
	</insert>


	<select id="queryLable" parameterType="map" resultMap="articlePostLableMap">
		SELECT
		article_post_id articlePostId,
		article_post_lable_id articlePostLableId
		FROM article_post_relation
		WHERE article_post_id = #{postId}
	</select>

	<delete id="deleteRelation" parameterType="map">
		DELETE FROM
		article_post_relation
		WHERE
		article_post_id = #{arg0}
	</delete>

	<select id="queryLableNameByPostId" parameterType="map" resultMap="articlePostLableMap">
		SELECT
			GROUP_CONCAT(lable_name) lableName
		FROM
			article_post_lable
		WHERE
			id
		IN
		(
			SELECT
			article_post_lable_id articlePostLableId
			FROM article_post_relation
			WHERE
			article_post_id = #{arg0}
		)

	</select>
	<select id="qeuryAllLable" parameterType="map" resultMap="articlePostLableMap">
		SELECT
		<include refid="Base_Column_List"/>
		FROM
		article_post_lable
		ORDER BY
		modify_time
		DESC
	</select>
	<select id="getArticlePostId" parameterType="map" resultType="string">
		SELECT article_post_id articlePostId
		FROM article_post_relation
		WHERE article_post_lable_id = #{postLableId}
	</select>
	<select id="queryLableByName" parameterType="map" resultType="int">
		SELECT count(1)
		FROM
			article_post_lable
		WHERE lable_name = #{arg0}
	</select>
</mapper>